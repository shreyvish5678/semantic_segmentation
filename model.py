from keras.layers import Input, Conv2D, MaxPooling2D, UpSampling2D, Concatenate
from keras import Model

input_img = Input(shape=(256, 256, 3))
x1 = Conv2D(64, (3, 3), activation='relu', padding='same')(input_img)
x2 = Conv2D(64, (3, 3), activation='relu', padding='same')(x1)
x3 = MaxPooling2D((2, 2))(x2)
x4 = Conv2D(128, (3, 3), activation='relu', padding='same')(x3)
x5 = Conv2D(128, (3, 3), activation='relu', padding='same')(x4)
x6 = MaxPooling2D((2, 2))(x5)
x7 = Conv2D(256, (3, 3), activation='relu', padding='same')(x6)
x8 = Conv2D(256, (3, 3), activation='relu', padding='same')(x7)
x9 = MaxPooling2D((2, 2))(x8)
x10 = Conv2D(512, (3, 3), activation='relu', padding='same')(x9)
x11 = Conv2D(512, (3, 3), activation='relu', padding='same')(x10)
x12 = MaxPooling2D((2, 2))(x11)
x13 = Conv2D(1024, (3, 3), activation='relu', padding='same')(x12)
x14 = Conv2D(1024, (3, 3), activation='relu', padding='same')(x13)
x15 = UpSampling2D((2, 2))(x14)
x16 = Concatenate()([x11, x15])     
x17 = Conv2D(512, (3, 3), activation='relu', padding='same')(x16)
x18 = Conv2D(512, (3, 3), activation='relu', padding='same')(x17)
x19 = UpSampling2D((2, 2))(x18)
x20 = Concatenate()([x8, x19])
x21 = Conv2D(256, (3, 3), activation='relu', padding='same')(x20)
x22 = Conv2D(256, (3, 3), activation='relu', padding='same')(x21)
x23 = UpSampling2D((2, 2))(x22)
x24 = Concatenate()([x5, x23]) 
x25 = Conv2D(128, (3, 3), activation='relu', padding='same')(x24)
x26 = Conv2D(64, (3, 3), activation='relu', padding='same')(x25)
x27 = UpSampling2D((2, 2))(x26)
x28 = Concatenate()([x2, x27]) 
x29 = Conv2D(64, (3, 3), activation='relu', padding='same')(x28)
x30 = Conv2D(64, (3, 3), activation='relu', padding='same')(x29)
x31 = Conv2D(3, (3, 3), activation='sigmoid', padding='same')(x30) 

u_net = Model(input_img, x31)
u_net.summary()